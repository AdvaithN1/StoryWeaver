<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GET Request Example</title>
    
</head>
<body>


  <label>Enter your theme
    <input list="themes" name="myBrowser" id="theme"/></label>
    <datalist id="themes">
      <option value="Children's Book">
      <option value="Story">
      <option value="Lesson">
    </datalist>
  <br>
    <textarea id="text" placeholder="Enter your prompt here..."></textarea>
    <br>
    <button id="submitBtnText">Submit</button>
    <br>
    <br>

    <text id="textGemini">Gemini input Response...</text>
<div id="imageContainer"></div>

<script type="importmap">
    {
      "imports": {
        "@google/generative-ai": "https://esm.run/@google/generative-ai"
      }
    }
</script>

<script type="module">

import {
    GoogleGenerativeAI,
    HarmCategory,
    HarmBlockThreshold,
  } from "@google/generative-ai"
  
  

    async function generateImage(prompt) {
        const encodedPrompt = encodeURIComponent(prompt);

        // Construct the full URL for image generation
        const imageUrl = `https://image.pollinations.ai/prompt/${encodedPrompt}`;
        console.log('Image Generation URL:', imageUrl);

        // Make the GET request to the image generator
        // return fetch(imageUrl);
    // })
    fetch(imageUrl)
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        console.log(response);
        return response.blob(); // Get the response as a blob (binary data)
    })
    .then(blob => {
        // Create an object URL for the blob
        const imageBlobUrl = URL.createObjectURL(blob);

        // Create an img element and set its src attribute
        const img = document.createElement('img');
        img.src = imageBlobUrl;
        img.alt = 'Generated Image';

        // Append the img element to the image container
        const imageContainer = document.getElementById('imageContainer');
        imageContainer.innerHTML = ''; // Clear previous images
        imageContainer.appendChild(img);
    })
    .catch(error => {
        console.error('There was a problem with the fetch operation:', error);
    });
    }

const MODEL_NAME = "gemini-1.0-pro";
  const API_KEY = "AIzaSyCcqCtpkSK8nAsQLrkXGJZ5rq2T2jc1MBQ";
  
  async function runChat(prompt) {
    const genAI = new GoogleGenerativeAI(API_KEY);
    const model = genAI.getGenerativeModel({ model: MODEL_NAME });
  
    const generationConfig = {
      temperature: 0.9,
      topK: 1,
      topP: 1,
      maxOutputTokens: 2048,
    };
  
    const safetySettings = [
      {
        category: HarmCategory.HARM_CATEGORY_HARASSMENT,
        threshold: HarmBlockThreshold.BLOCK_NONE,
      },
      {
        category: HarmCategory.HARM_CATEGORY_HATE_SPEECH,
        threshold: HarmBlockThreshold.BLOCK_NONE,
      },
      {
        category: HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT,
        threshold: HarmBlockThreshold.BLOCK_NONE,
      },
      {
        category: HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT,
        threshold: HarmBlockThreshold.BLOCK_NONE,
      },
    ];
  
    const chat = model.startChat({
      generationConfig,
      safetySettings,
      history: [
      ],
    });

    const result = await chat.sendMessage(prompt);
    const response = result.response;
    console.log(response.text());
    // await generateImage(response.text());
    document.getElementById('textGemini').innerText = response.text();
  }


document.getElementById('submitBtnText').addEventListener('click', function() {

    // Get the value of the textarea
    // const prompt = document.getElementById('text').value;
    // console.log(prompt)
    const theme = document.getElementById('theme').value;
    const prompt = document.getElementById('text').value;
    
    runChat(`Write me the text for a ${theme} on the topic of ${prompt}`);
    generateImage(prompt);
    // Make the POST request to the /generate-text endpoint


    // fetch('/generate-text', {
    //     method: 'POST',
    //     headers: {
    //         'Content-Type': 'application/json',

    //     },
    //     body: JSON.stringify({ prompt })
    // })
    // .then(response => {
    //     if (!response.ok) {
    //         console.error(response.status);
    //         throw new Error('Network response was not okkk');
    //     }
    //     return response.json(); // Get the response as JSON
    // })
    
    
});



</script>

</body>
</html>
