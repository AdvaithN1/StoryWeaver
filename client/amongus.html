<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/amongus.css">
    <title>GET Request Example</title>
    
</head>
<body>


  <label style="color:white;">Enter your theme
    <input list="themes" name="myBrowser" id="theme"/></label>
    <datalist id="themes">
      <option value="Children's Book">
      <option value="Story">
      <option value="Lesson">
    </datalist>
  <br>
    <textarea id="text" placeholder="Enter your prompt here..."></textarea>
    <br>
    <button id="submitBtnText">Submit</button>
    <br>
    <br>

    <text id="textGemini" style="color:white;">Gemini input Response...</text>
<div id="imageContainer"></div>

<script type="importmap">
    {
      "imports": {
        "@google/generative-ai": "https://esm.run/@google/generative-ai"
      }
    }
</script>

<script type="module">

    var imagearrs = [];
    var textarrs = [];

import {
    GoogleGenerativeAI,
    HarmCategory,
    HarmBlockThreshold,
  } from "@google/generative-ai"

    async function generateImage(prompt, index) {
        const encodedPrompt = encodeURIComponent(prompt);

        // Construct the full URL for image generation
        const imageUrl = `https://image.pollinations.ai/prompt/${encodedPrompt}`;
        console.log('Image Generation URL:', imageUrl);

        // Make the GET request to the image generator
        // return fetch(imageUrl);
    // })
    fetch(imageUrl)
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        // console.log(response);
        return response.blob(); // Get the response as a blob (binary data)
    })
    .then(blob => {
        // Create an object URL for the blob
        const imageBlobUrl = URL.createObjectURL(blob);
        console.log(blob)

        // Create an img element and set its src attribute
        const img = document.createElement('img');
        img.src = imageBlobUrl;
        img.alt = 'Generated Image';
        
        // Append the img element to the image container
        const imageContainer = document.getElementById('imageContainer');
        // imageContainer.innerHTML = ''; // Clear previous images
        const tex = document.createElement('text');
        tex.innerText = "Image for paragraph number" + textarrs[index];
        console.log("FINISHED GENERATING IMAGE FOR PARAGRAPH NUMBER", textarrs[index]);
        imageContainer.appendChild(tex);
        
        imageContainer.appendChild(img);
    })
    .catch(error => {
        console.error('There was a problem with the fetch operation:', error);
    });
    }

const MODEL_NAME = "gemini-1.0-pro";
  const API_KEY = "AIzaSyCcqCtpkSK8nAsQLrkXGJZ5rq2T2jc1MBQ";
  
  async function runChat(prompt) {
    const genAI = new GoogleGenerativeAI(API_KEY);
    const model = genAI.getGenerativeModel({ model: MODEL_NAME });
  
    const generationConfig = {
      temperature: 0.9,
      topK: 1,
      topP: 1,
      maxOutputTokens: 2048,
    };
  
    const safetySettings = [
      {
        category: HarmCategory.HARM_CATEGORY_HARASSMENT,
        threshold: HarmBlockThreshold.BLOCK_NONE,
      },
      {
        category: HarmCategory.HARM_CATEGORY_HATE_SPEECH,
        threshold: HarmBlockThreshold.BLOCK_NONE,
      },
      {
        category: HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT,
        threshold: HarmBlockThreshold.BLOCK_NONE,
      },
      {
        category: HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT,
        threshold: HarmBlockThreshold.BLOCK_NONE,
      },
    ];
  
    const chat = model.startChat({
      generationConfig,
      safetySettings,
      history: [
      ],
    });

    const result = await chat.sendMessage(prompt);
    const response = result.response;
    console.log(response.text());
    // await generateImage(response.text());
    document.getElementById('textGemini').innerText = response.text();
    textarrs = response.text().split('\n');
    console.log(textarrs);
    textarrs = textarrs.filter(element => element !== "");
    for (let i = 0; i < textarrs.length; i++) {
      generateImage(textarrs[i], i);
    }
    // generateImage(prompt);
  }


document.getElementById('submitBtnText').addEventListener('click', function() {

    // Get the value of the textarea
    // const prompt = document.getElementById('text').value;
    // console.log(prompt)
    const theme = document.getElementById('theme').value;
    const prompt = document.getElementById('text').value;
    
    runChat(`Write me the text for a ${theme} on the topic of ${prompt}`);
    // generateImage(prompt);
    // Make the POST request to the /generate-text endpoint


    // fetch('/generate-text', {
    //     method: 'POST',
    //     headers: {
    //         'Content-Type': 'application/json',

    //     },
    //     body: JSON.stringify({ prompt })
    // })
    // .then(response => {
    //     if (!response.ok) {
    //         console.error(response.status);
    //         throw new Error('Network response was not okkk');
    //     }
    //     return response.json(); // Get the response as JSON
    // })
    
    
});



</script>




























<!-- YUFANS CORNER -->



<div class="book">
  <div class="page">
    <div class="front">
      <h1>FlipBook</h1>
      <h3>2023.<br>Second edition</h3>
    </div>
    <div class="back">
      <h2>Lorem Ipsum</h2>
      1. Lorem ipsum dolor sit amet consectetur adipisicing elit. Commodi, modi, perspiciatis molestias cum neque delectus eum eveniet repellat iusto totam magnam cupiditate quaerat quis.
    </div>
  </div>

  <div class="page">
    <div class="front">
      2. Dolor Molestias aspernatur repudiandae sed quos debitis recusandae consectetur ab facilis voluptates sint vero eos, consequuntur delectus?
    </div>
    <div class="back">
      <img src="https://picsum.photos/500/400" alt="Img 1">
    </div>
  </div>

  <div class="page">
    <div class="front">
      <h2>Sit amet</h2>
      4. Consectetur adipisicing elit. Dignissimos illo voluptate sapiente provident tempore ea voluptates perferendis tenetur eos nulla, doloribus! Distinctio a nostrum ipsum, adipisci at mollitia.
    </div>
    <div class="back">
      5. Debitis recusandae consectetur ab facilis voluptates sint vero eos, consequuntur delectus temporibus harum dolorem provident eaque perferendis.
    </div>
  </div>

  <div class="page">
    <div class="front">
      <h2>Consectetur</h2>
      6. Adipisicing elit. Sed, fuga aspernatur? Numquam, molestias unde! Voluptatibus sint aspernatur qui dolore est itaque ipsum consequuntur neque asperiores non obcaecati harum, perspiciatis voluptate!
    </div>
    <div class="back">
      7. Temporibus, eum nobis? Adipisci, a? Eaque vel amet ut reprehenderit.
    </div>
  </div>

  <div class="page">
    <div class="front">
      <img src="https://picsum.photos/536/354" alt="Img 2">
    </div>
    <div class="back">
      <h3>Finalis</h3>
      9. Lorem ipsum dolor sit, amet consectetur adipisicing elit. code by Roko, eniam vero, magni dignissimos deleniti hic ratione sequi ullam eos.
    </div>
  </div>
</div>





<script>
  const flipBook = (elBook) => {
  elBook.style.setProperty("--c", 0); // Set current page
  elBook.querySelectorAll(".page").forEach((page, idx) => {
    page.style.setProperty("--i", idx);
    page.addEventListener("click", (evt) => {
      const curr = evt.target.closest(".back") ? idx : idx + 1;
      elBook.style.setProperty("--c", curr);
    });
  });
};

document.querySelectorAll(".book").forEach(flipBook);
</script>

</body>
</html>
